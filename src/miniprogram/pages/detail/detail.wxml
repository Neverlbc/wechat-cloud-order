<!--pages/detail/detail.wxml-->
<view class="detail-page">
  
  <!-- 商品大图 -->
  <view class="hero-section">
    <image class="hero-image" src="{{goods.image}}" mode="aspectFill"></image>
    <view class="hero-overlay"></view>
    <!-- 返回按钮 -->
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">‹</text>
    </view>
  </view>

  <!-- 商品信息 -->
  <view class="info-card">
    <view class="info-main">
      <view class="info-left">
        <text class="goods-name">{{goods.name}}</text>
        <text class="goods-desc">{{goods.desc}}</text>
        <view class="goods-tags">
          <text class="tag" wx:if="{{goods.hasSpecs}}">可加料</text>
          <text class="tag">现做现煮</text>
          <text class="tag">招牌推荐</text>
        </view>
      </view>
      <view class="info-price">
        <text class="price-symbol">¥</text>
        <text class="price-number">{{goods.price}}</text>
        <text class="price-unit">/份</text>
      </view>
    </view>
    <view class="sales-info">
      <text class="sales-text">月售 {{goods.sales || 99}}+</text>
      <text class="dot">·</text>
      <text class="sales-text">好评率 98%</text>
    </view>
  </view>

  <!-- 口味选择 -->
  <view class="section-card" wx:if="{{spicyOptions.length > 0}}">
    <view class="section-header-row">
      <text class="section-label">🌶️ 辣度</text>
      <text class="section-required">必选</text>
    </view>
    <view class="option-grid">
      <view 
        class="option-chip {{selectedSpicy === index ? 'active' : ''}}" 
        wx:for="{{spicyOptions}}" 
        wx:key="index"
        bindtap="onSpicyChange"
        data-index="{{index}}"
      >
        <text>{{item}}</text>
      </view>
    </view>
  </view>

  <!-- 自选加料 -->
  <view class="section-card" wx:if="{{goods.hasSpecs && goods.specs.length > 0}}">
    <view class="section-header-row">
      <text class="section-label">✨ 自选加料</text>
      <text class="section-sub">可多选</text>
    </view>
    <view class="specs-list">
      <view 
        class="spec-item {{item.checked ? 'checked' : ''}}" 
        wx:for="{{goods.specs}}" 
        wx:key="name"
        bindtap="onSpecToggle"
        data-index="{{index}}"
      >
        <view class="spec-left">
          <view class="spec-checkbox {{item.checked ? 'active' : ''}}">
            <text wx:if="{{item.checked}}" class="check-icon">✓</text>
          </view>
          <text class="spec-name">{{item.name}}</text>
        </view>
        <text class="spec-price">+¥{{item.price}}</text>
      </view>
    </view>
  </view>

  <!-- 数量选择 -->
  <view class="section-card">
    <view class="section-header-row">
      <text class="section-label">📦 数量</text>
    </view>
    <view class="quantity-row">
      <text class="quantity-hint">单份价格 ¥{{unitPrice}}</text>
      <view class="quantity-stepper">
        <view class="stepper-btn {{quantity <= 1 ? 'disabled' : ''}}" bindtap="onQuantityMinus">−</view>
        <text class="stepper-value">{{quantity}}</text>
        <view class="stepper-btn" bindtap="onQuantityPlus">+</view>
      </view>
    </view>
  </view>

  <!-- 底部安全区占位 -->
  <view style="height: 180rpx;"></view>

  <!-- 底部操作栏 -->
  <view class="action-bar">
    <view class="action-left">
      <view class="action-price-info">
        <text class="action-label">合计</text>
        <view class="action-price">
          <text class="action-symbol">¥</text>
          <text class="action-amount">{{totalPrice}}</text>
        </view>
      </view>
      <text class="action-specs-text" wx:if="{{selectedSpecsText}}">{{selectedSpecsText}}</text>
    </view>
    <view class="action-btn" bindtap="onAddToCart">
      <text class="btn-icon">🛒</text>
      <text>加入购物车</text>
    </view>
  </view>
</view>
