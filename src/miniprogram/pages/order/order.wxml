<!--pages/order/order.wxml-->
<view class="order-page">

  <!-- Tab é€‰é¡¹å¡ -->
  <view class="order-tabs">
    <view 
      class="tab-item {{currentTab === index ? 'active' : ''}}" 
      wx:for="{{tabs}}" 
      wx:key="index"
      bindtap="onTabChange"
      data-index="{{index}}"
    >
      <text>{{item}}</text>
      <view class="tab-line" wx:if="{{currentTab === index}}"></view>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view class="order-list" scroll-y enhanced show-scrollbar="{{false}}">
    <block wx:if="{{filteredOrders.length > 0}}">
      <view 
        class="order-card" 
        wx:for="{{filteredOrders}}" 
        wx:key="orderId"
        bindtap="onOrderTap"
        data-id="{{item.orderId}}"
      >
        <!-- å¡ç‰‡å¤´éƒ¨ -->
        <view class="card-header">
          <view class="order-id">
            <text class="order-label">è®¢å•å·</text>
            <text class="order-num">{{item.orderId}}</text>
          </view>
          <view class="order-status" style="color: {{statusMap[item.status].color}}">
            <text>{{statusMap[item.status].icon}} {{statusMap[item.status].text}}</text>
          </view>
        </view>

        <!-- å•†å“åˆ—è¡¨ -->
        <view class="card-items">
          <view class="card-item" wx:for="{{item.items}}" wx:for-item="goods" wx:key="id" wx:if="{{index < 3}}">
            <text class="card-item-name">{{goods.name}}</text>
            <text class="card-item-qty">x{{goods.quantity}}</text>
            <text class="card-item-price">Â¥{{goods.price * goods.quantity}}</text>
          </view>
          <view class="card-item-more" wx:if="{{item.items.length > 3}}">
            <text>è¿˜æœ‰ {{item.items.length - 3}} ä»¶å•†å“...</text>
          </view>
        </view>

        <!-- å¡ç‰‡åº•éƒ¨ -->
        <view class="card-footer">
          <view class="order-info">
            <text class="order-type">{{item.deliveryType === 'pickup' ? 'ğŸª è‡ªå–' : 'ğŸ›µ é…é€'}}</text>
            <text class="order-time">{{item.createTime}}</text>
          </view>
          <view class="order-total">
            <text class="total-label">åˆè®¡</text>
            <text class="total-value">Â¥{{item.totalAmount}}</text>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="card-actions">
          <view class="action-btn-outline" wx:if="{{item.status === 0}}" catchtap="onCancelOrder" data-id="{{item.orderId}}">å–æ¶ˆè®¢å•</view>
          <view class="action-btn-solid" wx:if="{{item.status === 4 || item.status === -1}}" catchtap="onReorder" data-id="{{item.orderId}}">å†æ¥ä¸€å•</view>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-title">æš‚æ— è®¢å•</text>
      <text class="empty-desc">å¿«å»ç‚¹ä¸€ç¢—çƒ­ä¹ä¹çš„ç ‚é”…ç²‰å§~</text>
      <view class="empty-btn" bindtap="goToMenu">å»ç‚¹é¤</view>
    </view>
  </scroll-view>
</view>
