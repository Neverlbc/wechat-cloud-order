<!--pages/checkout/checkout.wxml-->
<view class="checkout-page">

  <!-- é…é€åœ°å€å¡ç‰‡ -->
  <view class="address-card" bindtap="onEditAddress">
    <view class="address-content" wx:if="{{address.name}}">
      <view class="address-icon">ğŸ“</view>
      <view class="address-detail">
        <view class="address-user">
          <text class="user-name">{{address.name}}</text>
          <text class="user-phone">{{address.phone}}</text>
        </view>
        <view class="address-text">{{address.detail}}</view>
      </view>
      <view class="address-arrow">â€º</view>
    </view>
    <view class="address-empty" wx:else>
      <view class="address-icon">ğŸ“</view>
      <text class="empty-text">è¯·å¡«å†™é…é€åœ°å€</text>
      <view class="address-arrow">â€º</view>
    </view>
    <!-- é”¯é½¿åº•è¾¹ -->
    <view class="address-zigzag"></view>
  </view>

  <!-- å•†å“æ¸…å• -->
  <view class="order-section">
    <view class="section-header">
      <text class="section-icon">ğŸ›’</text>
      <text class="section-title">å•†å“æ¸…å•</text>
      <text class="section-count">å…±{{totalCount}}ä»¶</text>
    </view>
    <view class="order-items">
      <view class="order-item" wx:for="{{cartItems}}" wx:key="id">
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-spec" wx:if="{{item.specDesc}}">{{item.specDesc}}</text>
        </view>
        <view class="item-right">
          <text class="item-quantity">x{{item.quantity}}</text>
          <text class="item-price">Â¥{{item.subtotal}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é…é€æ–¹å¼ -->
  <view class="order-section">
    <view class="section-header">
      <text class="section-icon">ğŸš—</text>
      <text class="section-title">é…é€æ–¹å¼</text>
    </view>
    <view class="delivery-options">
      <view 
        class="delivery-option {{deliveryType === 'delivery' ? 'active' : ''}}" 
        bindtap="onDeliveryChange" 
        data-type="delivery"
      >
        <text class="delivery-emoji">ğŸ›µ</text>
        <text>å¤–å–é…é€</text>
      </view>
      <view 
        class="delivery-option {{deliveryType === 'pickup' ? 'active' : ''}}" 
        bindtap="onDeliveryChange" 
        data-type="pickup"
      >
        <text class="delivery-emoji">ğŸª</text>
        <text>åˆ°åº—è‡ªå–</text>
      </view>
    </view>
  </view>

  <!-- å¤‡æ³¨ -->
  <view class="order-section">
    <view class="section-header">
      <text class="section-icon">ğŸ“</text>
      <text class="section-title">å¤‡æ³¨</text>
    </view>
    <view class="remark-box">
      <textarea 
        class="remark-input" 
        placeholder="å£å‘³åå¥½ã€è¿‡æ•ä¿¡æ¯ç­‰ï¼ˆé€‰å¡«ï¼‰" 
        placeholder-class="remark-placeholder"
        maxlength="200"
        value="{{remark}}"
        bindinput="onRemarkInput"
      ></textarea>
      <text class="remark-counter">{{remark.length}}/200</text>
    </view>
  </view>

  <!-- é‡‘é¢æ˜ç»† -->
  <view class="order-section price-section">
    <view class="price-row">
      <text class="price-label">å•†å“å°è®¡</text>
      <text class="price-value">Â¥{{cartTotal}}</text>
    </view>
    <view class="price-row">
      <text class="price-label">é…é€è´¹</text>
      <text class="price-value {{deliveryFee === 0 ? 'free' : ''}}">
        {{deliveryFee === 0 ? 'å…é…é€è´¹' : 'Â¥' + deliveryFee}}
      </text>
    </view>
    <view class="price-row">
      <text class="price-label">åŒ…è£…è´¹</text>
      <text class="price-value">Â¥{{packingFee}}</text>
    </view>
    <view class="price-divider"></view>
    <view class="price-row total">
      <text class="price-label">åˆè®¡</text>
      <view class="total-amount">
        <text class="total-symbol">Â¥</text>
        <text class="total-number">{{totalAmount}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºå ä½ -->
  <view style="height: 180rpx;"></view>

  <!-- åº•éƒ¨ç»“ç®—æ  -->
  <view class="submit-bar">
    <view class="submit-left">
      <text class="submit-label">å®ä»˜</text>
      <view class="submit-price">
        <text class="submit-symbol">Â¥</text>
        <text class="submit-amount">{{totalAmount}}</text>
      </view>
    </view>
    <view class="submit-btn {{canSubmit ? '' : 'disabled'}}" bindtap="onSubmitOrder">
      æäº¤è®¢å•
    </view>
  </view>
</view>

<!-- åœ°å€ç¼–è¾‘å¼¹çª— -->
<view class="address-modal-mask {{showAddressModal ? 'show' : ''}}" bindtap="onCloseAddressModal"></view>
<view class="address-modal {{showAddressModal ? 'show' : ''}}">
  <view class="modal-header">
    <text class="modal-title">é…é€åœ°å€</text>
    <view class="modal-close" bindtap="onCloseAddressModal">âœ•</view>
  </view>
  <view class="modal-body">
    <view class="form-item">
      <text class="form-label">è”ç³»äºº</text>
      <input class="form-input" placeholder="è¯·è¾“å…¥å§“å" value="{{addressForm.name}}" bindinput="onAddressInput" data-field="name" />
    </view>
    <view class="form-item">
      <text class="form-label">æ‰‹æœºå·</text>
      <input class="form-input" type="number" maxlength="11" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="{{addressForm.phone}}" bindinput="onAddressInput" data-field="phone" />
    </view>
    <view class="form-item">
      <text class="form-label">è¯¦ç»†åœ°å€</text>
      <input class="form-input" placeholder="æ¥¼æ ‹/é—¨ç‰Œå·ç­‰" value="{{addressForm.detail}}" bindinput="onAddressInput" data-field="detail" />
    </view>
  </view>
  <view class="modal-footer">
    <view class="modal-save-btn" bindtap="onSaveAddress">ä¿å­˜åœ°å€</view>
  </view>
</view>
