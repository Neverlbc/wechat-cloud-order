<!--pages/index/index.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨è®¾è®¡åŒºåŸŸ (High-End Design) -->
  <view class="header-container">
    <!-- èƒŒæ™¯è£…é¥° -->
    <view class="header-bg-decoration"></view>
    
    <!-- å“ç‰Œä¸»å±•ç¤º -->
    <view class="brand-section">
      <view class="brand-left">
        <view class="brand-name-box">
          <text class="brand-name">ä¸€å‘³é²œ</text>
          <text class="brand-seal">ç”„é€‰</text> <!-- æ¨¡æ‹Ÿçº¢è‰²å°ç«  -->
        </view>
        <view class="brand-info">
          <text class="shop-status">è¥ä¸šä¸­</text>
          <text class="shop-distance">è·æ‚¨ 800m</text>
        </view>
        <view class="brand-tags">
          <text class="tag">ç°ç†¬é«˜æ±¤</text>
          <text class="divider">Â·</text>
          <text class="tag">ä¼ ç»Ÿç ‚é”…</text>
        </view>
      </view>
      <view class="brand-right-logo">
        <text class="logo-emoji">ğŸŒ¿</text>
      </view>
    </view>

    <!-- æ‚¬æµ®æœç´¢æ¡† -->
    <view class="search-box-glass">
      <text class="search-icon">ğŸ”</text>
      <swiper class="search-swiper" autoplay vertical circular interval="3000">
        <swiper-item><view class="placeholder-text">è¯•è¯•â€œé…¸æ±¤ç ‚é”…ç²‰â€</view></swiper-item>
        <swiper-item><view class="placeholder-text">æ‹›ç‰Œâ€œçº¢çƒ§ç‰›è‚‰é¢â€</view></swiper-item>
      </swiper>
      <view class="search-btn">æœç´¢</view>
    </view>
  </view>

  <!-- ä¸»ä½“å†…å®¹ï¼šå·¦ä¾§åˆ†ç±» + å³ä¾§å•†å“ -->
  <view class="main-content">
    <!-- å·¦ä¾§åˆ†ç±»å¯¼èˆª -->
    <scroll-view class="category-nav" scroll-y enhanced show-scrollbar="{{false}}">
      <view 
        class="category-item {{currentCategory === index ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="id"
        bindtap="onCategoryTap"
        data-index="{{index}}"
      >
        <text class="category-name">{{item.name}}</text>
      </view>
    </scroll-view>

    <!-- å³ä¾§å•†å“åˆ—è¡¨ -->
    <scroll-view 
      class="goods-list" 
      scroll-y 
      enhanced 
      show-scrollbar="{{false}}"
      scroll-into-view="{{scrollIntoView}}"
    >
      <view 
        class="goods-section" 
        wx:for="{{categories}}" 
        wx:key="id"
        id="category-{{index}}"
      >
        <view class="section-title">{{item.name}}</view>
        <view class="goods-item" wx:for="{{item.goods}}" wx:for-item="goods" wx:for-index="gIdx" wx:key="id">
          <image class="goods-image" src="{{goods.image}}" mode="aspectFill" lazy-load bindtap="onGoodsTap" data-cat-index="{{index}}" data-goods-index="{{gIdx}}"></image>
          <view class="goods-info">
            <view bindtap="onGoodsTap" data-cat-index="{{index}}" data-goods-index="{{gIdx}}">
              <view class="goods-name">{{goods.name}}</view>
              <view class="goods-desc">{{goods.desc}}</view>
              <view class="goods-spec-hint" wx:if="{{goods.hasSpecs}}">
                <text class="spec-hint-icon">âœ¨</text>
                <text>å¯åŠ æ–™</text>
              </view>
            </view>
            <view class="goods-bottom">
              <view class="goods-price">
                <text class="price-symbol">Â¥</text>
                <text class="price-value">{{goods.price}}</text>
              </view>
              <view class="goods-actions">
                <view class="add-cart-btn" wx:if="{{goods.quantity === 0}}" catchtap="onPlus" data-goods="{{goods}}">
                  <text class="add-cart-icon">ğŸ›’</text>
                  <text>åŠ å…¥è´­ç‰©è½¦</text>
                </view>
                <view class="quantity-control" wx:else>
                  <view class="action-btn minus" catchtap="onMinus" data-goods="{{goods}}">-</view>
                  <text class="quantity">{{goods.quantity}}</text>
                  <view class="action-btn plus" catchtap="onPlus" data-goods="{{goods}}">+</view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- é®ç½©å±‚ -->
  <view class="cart-mask {{showCartDetail ? 'show' : ''}}" bindtap="hideCartDetail"></view>

  <!-- è´­ç‰©è½¦è¯¦æƒ…å¼¹çª— -->
  <view class="cart-popup {{showCartDetail && cartCount > 0 ? 'show' : ''}}">
    <view class="popup-header">
      <text class="popup-title">å·²é€‰å•†å“</text>
      <view class="clear-cart" bindtap="onClearCart">
        <text style="margin-right: 6rpx;">ğŸ—‘ï¸</text>
        <text>æ¸…ç©ºè´­ç‰©è½¦</text>
      </view>
    </view>
    <scroll-view class="popup-list" scroll-y>
      <block wx:for="{{categories}}" wx:key="id" wx:for-item="category">
        <block wx:for="{{category.goods}}" wx:key="id" wx:for-item="item">
          <view class="cart-item" wx:if="{{item.quantity > 0}}">
            <view class="cart-item-info" bindtap="onCartItemTap" data-goods="{{item}}">
              <view class="cart-item-name">{{item.name}}</view>
              <view class="cart-item-spec" wx:if="{{item.specDesc}}">{{item.specDesc}}</view>
              <view class="cart-item-spec cart-item-spec-none" wx:else>{{item.hasSpecs ? 'æœªåŠ æ–™' : ''}}</view>
            </view>
            <view class="cart-item-right">
              <view class="cart-item-price">Â¥{{item.price * item.quantity + (item.extraFee || 0) * item.quantity}}</view>
              <view class="cart-qty-control">
                <view class="cart-qty-btn" catchtap="onMinus" data-goods="{{item}}">-</view>
                <text class="cart-qty-num">{{item.quantity}}</text>
                <view class="cart-qty-btn" catchtap="onPlus" data-goods="{{item}}">+</view>
              </view>
            </view>
          </view>
        </block>
      </block>
    </scroll-view>
    <view class="popup-footer"></view>
  </view>

  <!-- æµ®åŠ¨ç»“ç®—æ  (ä»…åœ¨æœ‰å•†å“æ—¶æ˜¾ç¤º) -->
  <view class="float-cart-bar {{cartCount > 0 ? 'show' : ''}}">
    <view class="cart-content" bindtap="showCartDetail">
      <view class="cart-icon-box">
        <text class="cart-emoji">ğŸ›’</text>
        <view class="cart-count-badge">{{cartCount}}</view>
      </view>
      <view class="cart-price-info">
        <view class="price-row">
          <text class="symbol">Â¥</text>
          <text class="total-price">{{cartTotal}}</text>
        </view>
        <text class="delivery-tip">é¢„ä¼°æ»¡Â¥20èµ·é€</text>
      </view>
      <view class="checkout-btn" catchtap="goCheckout">
        å»ç»“ç®—
      </view>
    </view>
  </view>
</view>
