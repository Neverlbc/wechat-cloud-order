<!--pages/admin-orders/admin-orders.wxml-->
<view class="admin-orders-page">

  <!-- çŠ¶æ€ç­›é€‰ Tab -->
  <view class="filter-tabs">
    <view 
      class="tab-item {{currentTab === idx ? 'active' : ''}}"
      wx:for="{{tabs}}"
      wx:key="status"
      wx:for-index="idx"
      bindtap="onTabChange"
      data-index="{{idx}}"
    >
      <text>{{item.label}}</text>
      <view class="tab-badge" wx:if="{{item.count > 0}}">{{item.count}}</view>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view class="order-scroll" scroll-y enhanced show-scrollbar="{{false}}">
    <view class="order-list" wx:if="{{filteredOrders.length > 0}}">
      <view class="order-card" wx:for="{{filteredOrders}}" wx:key="orderId">
        
        <!-- å¡ç‰‡å¤´éƒ¨ -->
        <view class="card-header">
          <view class="header-left">
            <text class="order-no">{{item.orderId}}</text>
            <text class="status-tag tag-{{item.status}}">{{item.statusText}}</text>
          </view>
          <text class="order-time">{{item.createTime}}</text>
        </view>

        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <view class="user-row">
          <text class="user-label">{{item.deliveryType === 'delivery' ? 'ğŸ›µ é…é€' : 'ğŸª è‡ªå–'}}</text>
          <text class="user-info" wx:if="{{item.address}}">{{item.address.name}} {{item.address.phone}}</text>
        </view>
        <view class="address-row" wx:if="{{item.deliveryType === 'delivery' && item.address}}">
          <text>ğŸ“ {{item.address.detail}}</text>
        </view>

        <!-- å•†å“æ˜ç»† -->
        <view class="goods-detail">
          <view class="goods-row" wx:for="{{item.items}}" wx:for-item="food" wx:key="id">
            <view class="goods-left">
              <text class="goods-name">{{food.name}}</text>
              <text class="goods-spec" wx:if="{{food.specDesc}}">{{food.specDesc}}</text>
            </view>
            <text class="goods-qty">x{{food.quantity}}</text>
            <text class="goods-price">Â¥{{food.price * food.quantity + (food.extraFee || 0) * food.quantity}}</text>
          </view>
        </view>

        <!-- å¤‡æ³¨ -->
        <view class="remark-row" wx:if="{{item.remark}}">
          <text class="remark-label">ğŸ“ å¤‡æ³¨ï¼š</text>
          <text class="remark-text">{{item.remark}}</text>
        </view>

        <!-- åº•éƒ¨ -->
        <view class="card-footer">
          <view class="total-row">
            <text class="total-label">åˆè®¡</text>
            <text class="total-amount">Â¥{{item.totalAmount}}</text>
          </view>

          <!-- æ“ä½œæŒ‰é’®ç»„ï¼šæ ¹æ®çŠ¶æ€åŠ¨æ€æ˜¾ç¤º -->
          <view class="btn-group">
            <!-- å¾…æ”¯ä»˜ -->
            <block wx:if="{{item.status === 0}}">
              <view class="op-btn btn-cancel" catchtap="onCancelOrder" data-id="{{item.orderId}}">å–æ¶ˆ</view>
            </block>
            <!-- å¾…ç¡®è®¤ -->
            <block wx:if="{{item.status === 1}}">
              <view class="op-btn btn-cancel" catchtap="onRejectOrder" data-id="{{item.orderId}}">æ‹’ç»</view>
              <view class="op-btn btn-primary" catchtap="onAcceptOrder" data-id="{{item.orderId}}">æ¥å•</view>
            </block>
            <!-- é…é€ä¸­ -->
            <block wx:if="{{item.status === 2}}">
              <view class="op-btn btn-primary" catchtap="onDelivered" data-id="{{item.orderId}}">ç¡®è®¤é€è¾¾</view>
            </block>
            <!-- å·²é€è¾¾ -->
            <block wx:if="{{item.status === 3}}">
              <view class="op-btn btn-done" catchtap="onComplete" data-id="{{item.orderId}}">å®Œæˆè®¢å•</view>
            </block>
          </view>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— è¯¥çŠ¶æ€çš„è®¢å•</text>
    </view>
  </scroll-view>

</view>
